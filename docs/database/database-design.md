# 通用管理系统数据库设计文档

## 📋 设计概述

本文档描述了通用管理系统的数据库设计，采用MySQL 8.0作为主要数据库，Redis作为缓存数据库。系统设计遵循RBAC权限模型，支持多租户架构，具备良好的扩展性和可维护性。

## 🎯 设计原则

### 1. 命名规范
- **表名**：小写字母，下划线分隔，统一前缀 `sys_`（系统表）、`biz_`（业务表）
- **字段名**：小写字母，下划线分隔，语义清晰
- **索引名**：`idx_表名_字段名`（普通索引）、`uk_表名_字段名`（唯一索引）
- **外键名**：`fk_表名_关联表名`

### 2. 字段设计规范
- **主键**：统一使用 `id` BIGINT，雪花算法生成
- **时间字段**：统一使用 `DATETIME` 类型，UTC时间存储
- **逻辑删除**：统一使用 `deleted` TINYINT，0-未删除，1-已删除
- **版本控制**：统一使用 `version` INT，支持乐观锁
- **创建信息**：`create_time`、`create_by`
- **更新信息**：`update_time`、`update_by`

### 3. 性能优化
- 合理设计索引，避免冗余索引
- 使用合适的字段类型，节省存储空间
- 对大表进行分区设计
- 冷热数据分离存储

### 4. 安全设计
- 敏感数据加密存储
- 用户密码使用BCrypt加密
- 重要操作记录审计日志
- 数据访问权限控制

## 📊 数据库架构

### 主库设计
```
common_items_db (主数据库)
├── 系统管理模块 (sys_*)
├── 用户业务模块 (biz_*)
├── 文件管理模块 (file_*)
├── 消息通知模块 (msg_*)
└── 日志审计模块 (log_*)
```

### 缓存设计
```
Redis缓存层
├── 用户会话缓存 (session:*)
├── 权限信息缓存 (permission:*)
├── 系统配置缓存 (config:*)
├── 文件信息缓存 (file:*)
└── 统计数据缓存 (stats:*)
```

## 🗂️ 表分类设计

### 1. 系统核心表 (sys_*)
- **用户权限相关**：用户、角色、权限、关联关系、社交登录
- **系统配置相关**：系统参数、字典数据、配置项

### 2. 业务功能表 (biz_*)
- **业务实体表**：具体业务相关的数据表
- **业务关系表**：业务实体间的关联关系
- **业务配置表**：业务相关的配置数据

### 3. 文件管理表 (file_*)
- **文件基础信息**：文件元数据、存储信息
- **文件关系表**：文件与业务实体关联
- **文件操作记录**：上传、下载、删除记录

### 4. 消息通知表 (msg_*)
- **消息模板**：通知模板配置
- **消息记录**：发送记录和状态
- **用户通知设置**：个性化通知配置

### 5. 日志审计表 (log_*)
- **操作日志**：用户操作记录
- **登录日志**：登录登出记录
- **系统日志**：系统运行日志
- **审计日志**：重要操作审计

## 🔗 核心关系设计

### RBAC权限模型
```
用户(User) ←→ 用户角色(UserRole) ←→ 角色(Role)
    ↕                                ↕
社交登录(UserSocial)            角色权限(RolePermission)
                                      ↕
                                   权限(Permission)
```



### 文件关联模型
```
业务实体 ←→ 文件关联(FileRelation) ←→ 文件信息(FileInfo)
                                      ↕
                                   存储信息(FileStorage)
```

## 📋 MVP阶段划分

### Stage 1: 核心基础功能
- [x] 用户管理相关表（5张）
- [x] 权限管理相关表（2张）
- [x] 系统配置相关表（2张）

### Stage 2: 基本业务功能
- [x] 文件管理相关表（4张）
- [x] 日志管理相关表（3张）

### Stage 3: 增强功能模块
- [ ] 消息通知相关表（4张）
- [ ] 定时任务相关表（2张）
- [ ] 数据统计相关表（3张）

### Stage 4: 高级功能特性
- [ ] 多租户相关表（2张）
- [ ] 国际化相关表（2张）
- [ ] 第三方集成相关表（3张）

## 🔧 数据库配置建议

### MySQL配置优化
```ini
# 基础配置
default-storage-engine = InnoDB
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M
innodb_flush_log_at_trx_commit = 1
sync_binlog = 1

# 字符集配置
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# 连接配置
max_connections = 200
max_connect_errors = 1000

# 查询缓存
query_cache_type = 1
query_cache_size = 32M
```

### 索引设计策略
1. **主键索引**：所有表必须有主键
2. **唯一索引**：唯一约束字段（用户名、邮箱等）
3. **普通索引**：查询频繁的字段
4. **组合索引**：多字段联合查询
5. **外键索引**：关联查询优化

### 分区表设计
对于大数据量表考虑分区：
- **日志表**：按时间分区（月分区）
- **用户数据表**：按用户ID范围分区
- **文件表**：按创建时间分区

## 📈 扩展性设计

### 1. 水平扩展
- 支持读写分离
- 支持分库分表
- 支持分布式事务

### 2. 垂直扩展
- 模块化表设计
- 微服务数据库隔离
- 跨服务数据一致性

### 3. 缓存策略
- 热点数据Redis缓存
- 查询结果缓存
- 分布式缓存一致性

## 🛡️ 安全与备份

### 数据安全
- 敏感字段加密存储
- 数据脱敏处理
- 访问权限控制
- SQL注入防护

### 备份策略
- 全量备份：每日凌晨
- 增量备份：每4小时
- Binlog备份：实时
- 异地备份：每周

## 📝 版本管理

### 数据库版本控制
- 使用Flyway进行数据库版本管理
- DDL变更脚本版本化
- 数据迁移脚本管理
- 回滚脚本准备

### 变更流程
1. 开发环境验证
2. 测试环境验证
3. 预生产验证
4. 生产环境发布
5. 监控与回滚

---

**文档版本**: v1.0  
**创建时间**: 2025-01-07  
**维护人员**: SparkFan  
**更新记录**: 初始版本创建 